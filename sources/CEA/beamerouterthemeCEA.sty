%% -------------------------------------------------------------------
%% Copyright 2024 Romain NOÃ‹L
%%
%% Based on the CEA theme presentation ppt and graphical charter
%% -------------------------------------------------------------------

\ProvidesExplPackage{beamerouterthemegothamCEA}{2024-10-15}{1.0.0.a}{CEA outer theme}

%\mode<presentation>

%%%
%%% === The Frametitle, sidebars and footer. =============================================

% command to insert institute logo on 'standard' frame
% \pgfdeclareimage[option]{label}{file}%
\ifbool{darkBG}{% Dark true
	\pgfdeclareimage[width=5mm]{CEAlogo}{\PathSOCEA/logos/LOGO_CEA_NOIR_SUR_BLANC.png}
}{% Light
	\pgfdeclareimage[width=5mm]{CEAlogo}{\PathSOCEA/logos/LOGO_CEA_ORIGINAL.png}
}%


%% Header & Frame title %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% frametile logo
\renewcommand{\gothamInstituteLogoSquare}[1][4ex]{
	\raisebox{4mm}{
		\pgfuseimage{CEAlogo}
	% \tikz[overlay,remember~picture]{
	% 	\node (rigthPattern) at ([shift={(-20pt,15pt)}]current~page.south~east) {\pgfuseimage{CEAlogo}};
	% }
	}
}

\defbeamertemplate{frametitle}{default/CEA~official}{
	\nointerlineskip
	\begin{beamercolorbox}[
			wd=\paperwidth,
			sep=0pt,
			leftskip=\gothamFrametitleLeftpading,
			rightskip=\gothamFrametitleRightpading,
		]{frametitle}
		\gotham@frametitlestrut@start
		\insertframetitle
		\ifx\insertframesubtitle\@empty
			%% if subtitle to the frame is empty
		\else
			%% if not empty: add subtitle
			{\usebeamerfont{framesubtitle}\usebeamercolor[fg]{framesubtitle}\gothamFrameSubtitleSep \insertframesubtitle}
			\vspace*{\gothamFramesubtitleStrutend}
		\fi
		\nolinebreak
		%% Add logo 
		% \hfill{
		% 	\setbeamertemplate{instituteLogo}[default/\prop_item:Nn \l__gotham_template_name_prop {instituteLogo/default}]
		% 	\usebeamertemplate{instituteLogo}
		% }
		\gotham@frametitlestrut@end
	\end{beamercolorbox}
}


%% Sidebars %%%
%%%%%%%%%%%%%%%

% % sidebar lengths
% \setlength{\sidebarRightHOffset}{-8.4mm}

% \ifnum\insertaspectratio=169 % 16:9
	\pgfdeclareimage[width=0.22\paperwidth]{CEAfiligrane}{\PathSOCEA/logos/TopCornerFrame_red.png}
% \else
% \ifnum\insertaspectratio=43 % 4:3
% 	\pgfdeclareimage[width=8.3mm]{CEAfiligrane}{\PathSOCEA/logos/pattern-frame43.pdf}
% \fi% end 4:3
% \fi% end 19:9

% % Command to add filigrane/edging in sidebar
\renewcommand{\gothamRightFiligrane}{
	\tikz[overlay,remember~picture]{
		\node (rigthPattern) at ([shift={(-35pt,-11pt)}]current~page.north~east) {\pgfuseimage{CEAfiligrane}};
	}
}


%% Footer %%%
%%%%%%%%%%%%%
\setlength{\gothamFootlineHeight}{2.ex} 
\setlength{\gothamFootlineRuleHeight}{0.5pt}
\setlength{\gothamFootlineHRightOffset}{10mm}
\renewcommand{\gothamHookFooter}{
	\setbeamertemplate{instituteLogo}[default/\prop_item:Nn \l__gotham_template_name_prop {instituteLogo/default}]
	\usebeamertemplate{instituteLogo}
}

% \defbeamertemplate{frame~footer}{default/CEA~official}{
% 	% add a ruler but wihtout affecting the dimensions of the footline
% 	\vbox to 0pt{
% 		% Vertical stretch to ensure proper spacing
% 		\vss 
% 		\hbox to 0pt{
% 			\hspace*{\gothamFootlineRuleLeftPadding}
% 			\usebeamercolor{frametitle}
% 			\color{frametitle.bg}
% 			\rule{\gothamFootlineRuleLength}{\gothamFootlineRuleHeight}
% 			\vspace*{
% 				\dimexpr \gothamFootlineHeight -0.25em\relax
% 			}
% 			% Horizontal stretch to ensure proper spacing
% 			\hss 
% 		}
% 	}
% 	%%% Add logo
% 	\setbeamertemplate{instituteLogo}[default/\prop_item:Nn \l__gotham_template_name_prop {instituteLogo/default}]
% 	\usebeamertemplate{instituteLogo}
	
% 	\hspace{\gothamLeftFooterPadding}
% 	\settowidth{\hlenLeftRotFooter}{\hspace{-\gothamLeftFooterPadding-3mm}}
% 	\addtolength{\hlenLeftRotFooter}{\gothamHposLeftRotFooter}
% 	% \ifbool{rotateFooter}{
% 	\bool_if:NTF \l_gotham_RotateFooter {
% 		% rotateFooter true
% 		\begin{picture}(0,0)(0,0)
% 			\put(\hlenLeftRotFooter,\gothamVposLeftRotFooter+2mm){\rotatebox{90}{\insertshortdate}}
% 		\end{picture}
% 	}{
% 		% rotateFooter false
% 		\insertshortdate
% 	}
% 	\hfill \
% 	\hfill \ \insertshorttitle 
% 	% make sure that the vertical space is constant: strut.
% 	\gotham@strut
% 	\hfill \ 
% 	\hfill \
	
% 	% \ifbool{rotateFooter}{
% 	\bool_if:NTF \l_gotham_RotateFooter {	
% 		% rotateFooter true
% 		\settowidth{\hlenRightRotFooter}{\hspace{\gothamRightFooterPadding}\usebeamertemplate{page~number~in~head/foot}\hspace*{\gothamFootlineHRightOffset}}
% 		\addtolength{\hlenRightRotFooter}{\gothamHposRightRotFooter}
% 		\begin{picture}(0,0)(0,0)
% 			\put(\hlenRightRotFooter,\gothamVposRightRotFooter){\rotatebox{90}{\insertshortauthor}}
% 		\end{picture}
% 	}{
% 		% rotateFooter false
% 		\insertshortauthor 
% 		%\hspace{-7em}
% 	}
% 	% decrease space between progress bar and footer
% 	\vspace*{\gothamFooterHOffset}
% }

%\mode<all>

%%
%% End of file `beamerouterthemeCEA.sty'.
